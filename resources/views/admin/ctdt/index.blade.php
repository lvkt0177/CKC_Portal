@extends('admin.layouts.app')

@section('title', 'Qu·∫£n l√Ω khung ƒë√†o t·∫°o')

@section('css')
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="{{ asset('assets/client/css/khungdaotao.css') }}">
@endsection


@section('content')

    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h3 class="card-title mb-0"> Ch∆∞∆°ng tr√¨nh ƒë√†o t·∫°o </h3>
                        <a href="{{ route('giangvien.ctdt.create') }}" class="btn btn-primary">Kh·ªüi t·∫°o tu·∫ßn</a>
                    </div>
                    <div class="card-body">
                        <div>
                            <form method="GET" action="{{ route('giangvien.ctdt.index') }}">

                                {{-- Dropdown Ng√†nh h·ªçc - lu√¥n hi·ªÉn th·ªã --}}
                                <label class="form-label fw-bold">Ng√†nh h·ªçc:</label>
                                <select name="id_nganh_hoc" class="form-control" onchange="this.form.submit()">
                                    <option value="">-- Ch·ªçn ng√†nh --</option>
                                    @foreach ($dsNganh as $nganh)
                                        <option value="{{ $nganh->id }}"
                                            {{ $id_nganh_hoc == $nganh->id ? 'selected' : '' }}>
                                            {{ $nganh->ten_nganh }}
                                        </option>
                                    @endforeach
                                </select>

                                {{-- Dropdown CTƒêT - ch·ªâ hi·ªán khi ƒë√£ ch·ªçn ng√†nh --}}
                                @if ($id_nganh_hoc && $ctdt->isNotEmpty())
                                    <label class="form-label fw-bold mt-2">Ch∆∞∆°ng tr√¨nh ƒë√†o t·∫°o:</label>
                                    <select name="id_chuong_trinh_dao_tao" class="form-control"
                                        onchange="this.form.submit()">
                                        <option value="">-- Ch·ªçn CTƒêT --</option>
                                        @foreach ($ctdt as $c)
                                            <option value="{{ $c->id }}"
                                                {{ $id_chuong_trinh_dao_tao == $c->id ? 'selected' : '' }}>
                                                {{ $c->ten_chuong_trinh_dao_tao }}
                                            </option>
                                        @endforeach
                                    </select>
                                @endif

                                {{-- Dropdown Ni√™n kh√≥a - ch·ªâ hi·ªán khi ƒë√£ ch·ªçn CTƒêT --}}
                                @if ($id_nganh_hoc && $id_chuong_trinh_dao_tao)
                                    <label class="form-label fw-bold mt-2">Ni√™n kh√≥a:</label>
                                    <select name="id_nien_khoa" class="form-control" onchange="this.form.submit()">
                                        <option value="">-- Ch·ªçn ni√™n kh√≥a --</option>
                                        @foreach ($dsNienKhoa as $nk)
                                            <option value="{{ $nk->id }}"
                                                {{ $id_nien_khoa == $nk->id ? 'selected' : '' }}>
                                                {{ $nk->ten_nien_khoa }}
                                            </option>
                                        @endforeach
                                    </select>
                                @endif

                            </form>

                        </div>
                    </div>

                    @php
                        $tongMonHoc = 0;
                        $tongSoTinChi = 0;
                        $tongSoTiet = 0;
                        $tongHocKy = count($ct_ctdt);

                        foreach ($ct_ctdt as $dsMon) {
                            $tongMonHoc += count($dsMon);
                            $tongSoTinChi += $dsMon->sum('so_tin_chi');
                            $tongSoTiet += $dsMon->sum('so_tiet');
                        }
                    @endphp
                    <div class="semester-card">

                        <div class="summary-section">
                            <div class="summary-header">
                                <div class="summary-icon">üìä</div>
                                <h2 class="summary-title">T·ªïng K·∫øt Ch∆∞∆°ng Tr√¨nh</h2>
                            </div>

                            <div class="summary-grid">
                                <div class="summary-item">
                                    <div class="summary-number">{{ $tongMonHoc }}</div>
                                    <div class="summary-label">T·ªïng m√¥n h·ªçc</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-number">{{ $tongSoTiet }}</div>
                                    <div class="summary-label">T·ªïng s·ªë ti·∫øt</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-number">{{ $tongSoTinChi }}</div>
                                    <div class="summary-label">T·ªïng t√≠n ch·ªâ</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-number">{{ $tongHocKy }}</div>
                                    <div class="summary-label">S·ªë h·ªçc k·ª≥</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Curriculum Grid -->
                    <div class="curriculum-grid" id="curriculumGrid">
                        <!-- Semester 1 -->
                        @foreach ($ct_ctdt as $hocKy => $danhSachMon)
                            <div class="semester-card">
                                <div class="semester-header">
                                    <h3 class="semester-title">
                                        {{ $ct_ctdt[$hocKy]->first()->hocKy->ten_hoc_ky ?? '---' }}
                                    </h3>
                                    <div class="semester-stats">
                                        <div class="stat-item">
                                            <div class="stat-icon">üìö</div>
                                            <span>{{ count($danhSachMon) }} m√¥n h·ªçc</span>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-icon">‚è±Ô∏è</div>
                                            <span>{{ $danhSachMon->sum('so_tiet') }} ti·∫øt</span>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-icon">üèÜ</div>
                                            <span>{{ $danhSachMon->sum('so_tin_chi') }}</span>
                                        </div>
                                    </div>
                                </div>
                                <table class="subjects-table">
                                    <thead class="table-header">
                                        <tr>
                                            <th>T√™n m√¥n h·ªçc</th>
                                            <th class="text-center">S·ªë ti·∫øt</th>
                                            <th class="text-center">S·ªë t√≠n ch·ªâ</th>
                                        </tr>
                                    </thead>
                                    <tbody class="table-body">
                                        @foreach ($danhSachMon as $ct)
                                            <tr>
                                                <td class="subject-name">{{ $ct->monHoc->ten_mon ?? 'Ch∆∞a c√≥' }}</td>
                                                <td class="subject-hours">{{ $ct->so_tiet }}</td>
                                                <td class="subject-credit">{{ $ct->so_tin_chi }}</td>
                                            </tr>
                                        @endforeach
                                    </tbody>
                                </table>
                            </div>
                        @endforeach
                    </div>

                </div>
            </div>
        </div>
    </div>

@endsection

@section('js')

@endsection
